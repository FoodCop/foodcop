# SNAP Feature - Visual Workflow & Component Map

## Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SNAP FEATURE WORKFLOW                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Disclaimer Dialog              â”‚
â”‚  (Food photo guidelines)         â”‚
â”‚  âœ“ Continue  âœ— Cancel           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚ Continue
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Image Input Step                â”‚â”€â”€â”€â”€â–¶â”‚ Camera Capture Section  â”‚
â”‚  Choose source:                  â”‚     â”‚ - Start camera          â”‚
â”‚  â”œâ”€ ğŸ“¸ Camera                    â”‚     â”‚ - Capture photo         â”‚
â”‚  â””â”€ ğŸ“ Gallery                   â”‚     â”‚ - Get geolocation       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                                            â”‚
  â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚                        â–¼
  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Gallery Upload Section  â”‚
                    â”‚ - File picker            â”‚
                    â”‚ - Preview image          â”‚
                    â”‚ - Crop/rotate tools      â”‚
                    â”‚ - Size validation        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Image Metadata                  â”‚
â”‚  â”œâ”€ imageData (base64)          â”‚
â”‚  â”œâ”€ latitude, longitude          â”‚
â”‚  â”œâ”€ timestamp                    â”‚
â”‚  â”œâ”€ accuracy                     â”‚
â”‚  â””â”€ source ('camera'|'gallery')  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tagging Step                    â”‚
â”‚  Photo preview + tag selection   â”‚
â”‚                                  â”‚
â”‚  Available tags:                 â”‚
â”‚  â€¢ Cuisine (Italian, Thai...)    â”‚
â”‚  â€¢ Dish (Pasta, Sushi...)        â”‚
â”‚  â€¢ Restaurant (name)             â”‚
â”‚  â€¢ Ambiance (cozy, modern...)    â”‚
â”‚  â€¢ Custom (user-defined)         â”‚
â”‚                                  â”‚
â”‚  Points earned: [dynamic]        â”‚
â”‚  â””â”€ Cuisine: +10                 â”‚
â”‚  â””â”€ Dish: +10                    â”‚
â”‚  â””â”€ Ambiance: +5                 â”‚
â”‚  â””â”€ TOTAL: _____ Points          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Card Formatting Step            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [Optimized Image]         â”‚  â”‚
â”‚  â”‚  Square crop, 600x600px    â”‚  â”‚
â”‚  â”‚  WebP optimized            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚  Caption: ___________________    â”‚
â”‚                                  â”‚
â”‚  Tags shown:                     â”‚
â”‚  [Italian] [Pasta] [Cozy]        â”‚
â”‚  Points: +25                     â”‚
â”‚                                  â”‚
â”‚  Preview format: âœ“               â”‚
â”‚  Ready to publish               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Publish Step                    â”‚
â”‚  Choose destination:             â”‚
â”‚                                  â”‚
â”‚  â—‹ Save to Plate (private)       â”‚
â”‚    â””â”€ Visible only in your       â”‚
â”‚       profile                    â”‚
â”‚                                  â”‚
â”‚  â—‹ Publish to Feed (public)      â”‚
â”‚    â””â”€ Visible to all users       â”‚
â”‚    â””â”€ Earn points                â”‚
â”‚    â””â”€ Get engagement (likes)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”œâ”€ Plate
  â”‚  â–¼
  â”‚  Save via PlateGateway
  â”‚
  â””â”€ Feed
     â–¼
     Save to feed_posts table
     â””â”€ Points awarded to user

  Both paths â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Success Dialog                  â”‚
â”‚  ğŸ‰ Saved!                       â”‚
â”‚                                  â”‚
â”‚  "Your food photo is now in      â”‚
â”‚   your Plate"                    â”‚
â”‚                                  â”‚
â”‚  +25 Points Earned! ğŸ†           â”‚
â”‚                                  â”‚
â”‚  Tags:                           â”‚
â”‚  Italian (+10), Pasta (+10),     â”‚
â”‚  Cozy (+5)                       â”‚
â”‚                                  â”‚
â”‚  [View in Plate] [Share to Feed] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
RESET WORKFLOW / CONTINUE
```

---

## Component Hierarchy

```
Snap (Main Orchestrator)
â”‚
â”œâ”€ DisclaimerDialog
â”‚  â”œâ”€ Title & description
â”‚  â”œâ”€ Do's & Don'ts
â”‚  â””â”€ Continue / Cancel buttons
â”‚
â”œâ”€ ImageInputStep
â”‚  â”œâ”€ CameraCapture (conditional)
â”‚  â”‚  â”œâ”€ Video preview
â”‚  â”‚  â”œâ”€ Capture button
â”‚  â”‚  â”œâ”€ Loading state
â”‚  â”‚  â””â”€ Permission handling
â”‚  â”‚
â”‚  â””â”€ GalleryUpload (conditional)
â”‚     â”œâ”€ File input
â”‚     â”œâ”€ Image preview
â”‚     â”œâ”€ Crop/rotate tools (optional)
â”‚     â”œâ”€ Size validation
â”‚     â””â”€ Cancel button
â”‚
â”œâ”€ TaggingStep
â”‚  â”œâ”€ CardPreview (read-only)
â”‚  â”‚  â”œâ”€ Image display
â”‚  â”‚  â”œâ”€ Location badge
â”‚  â”‚  â””â”€ Timestamp badge
â”‚  â”‚
â”‚  â”œâ”€ Tag selector
â”‚  â”‚  â”œâ”€ Cuisine buttons
â”‚  â”‚  â”œâ”€ Dish buttons
â”‚  â”‚  â”œâ”€ Ambiance buttons
â”‚  â”‚  â”œâ”€ Custom tag input
â”‚  â”‚  â””â”€ Add tag button
â”‚  â”‚
â”‚  â”œâ”€ Points indicator
â”‚  â”‚  â”œâ”€ Tag-by-tag breakdown
â”‚  â”‚  â””â”€ Total points
â”‚  â”‚
â”‚  â”œâ”€ Submit button
â”‚  â”œâ”€ Back button
â”‚  â””â”€ Cancel button
â”‚
â”œâ”€ CardFormattingStep
â”‚  â”œâ”€ CardPreview (interactive)
â”‚  â”‚  â”œâ”€ Optimized image
â”‚  â”‚  â”œâ”€ Selected tags
â”‚  â”‚  â””â”€ Points earned
â”‚  â”‚
â”‚  â”œâ”€ Caption input
â”‚  â”‚  â”œâ”€ Text area
â”‚  â”‚  â””â”€ Character counter
â”‚  â”‚
â”‚  â”œâ”€ Next button
â”‚  â”œâ”€ Back button
â”‚  â””â”€ Cancel button
â”‚
â”œâ”€ PublishStep
â”‚  â”œâ”€ CardPreview (final)
â”‚  â”‚  â”œâ”€ Full formatted card
â”‚  â”‚  â””â”€ All metadata
â”‚  â”‚
â”‚  â”œâ”€ Publish target selector
â”‚  â”‚  â”œâ”€ Plate option
â”‚  â”‚  â”‚  â”œâ”€ Icon & label
â”‚  â”‚  â”‚  â””â”€ Description
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ Feed option
â”‚  â”‚     â”œâ”€ Icon & label
â”‚  â”‚     â””â”€ Description + points note
â”‚  â”‚
â”‚  â”œâ”€ Publish button
â”‚  â”œâ”€ Back button
â”‚  â””â”€ Cancel button
â”‚
â””â”€ SuccessDialog
   â”œâ”€ Congratulations message
   â”œâ”€ Points earned display
   â”œâ”€ Tag breakdown
   â””â”€ Action buttons
      â”œâ”€ View in Plate
      â””â”€ Share to Feed (if saved to Plate)
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SNAP WORKFLOW DATA FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: IMAGE INPUT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Camera / Gallery
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ImageMetadata        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ imageData: string    â”‚ â—„â”€â”€â”€ Base64 encoded
  â”‚ latitude: number     â”‚ â—„â”€â”€â”€ From geolocation
  â”‚ longitude: number    â”‚ â—„â”€â”€â”€ From geolocation
  â”‚ timestamp: Date      â”‚ â—„â”€â”€â”€ Now
  â”‚ accuracy: number     â”‚ â—„â”€â”€â”€ GPS accuracy
  â”‚ source: string       â”‚ â—„â”€â”€â”€ 'camera' | 'gallery'
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ Store in workflow state
  useSnapWorkflow.setImageMetadata()


Step 2: TAGGING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  User selects tags
        â”‚
        â–¼
  snapGameification.calculatePoints(tags)
        â”‚
        â”œâ”€â†’ Tag: Italian       â”€â†’ +10 points
        â”œâ”€â†’ Tag: Pasta         â”€â†’ +10 points
        â”œâ”€â†’ Tag: Cozy          â”€â†’ +5 points
        â”‚
        â””â”€â†’ Total: 25 points
              â”‚
              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ SnapTag[]            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ id: string           â”‚
  â”‚ label: string        â”‚
  â”‚ category: string     â”‚
  â”‚ pointValue: number   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ Store in workflow state
  useSnapWorkflow.setTags(tags)


Step 3: CARD FORMATTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Base64 image + caption + tags + metadata
        â”‚
        â–¼
  snapCardFormatter.formatImageToCard()
        â”‚
        â”œâ”€â†’ optimizeSnapImage()
        â”‚   â””â”€â†’ Canvas processing
        â”‚   â””â”€â†’ Center-crop to 600x600
        â”‚   â””â”€â†’ WebP compression
        â”‚   â””â”€â†’ Return optimized URL
        â”‚
        â”œâ”€â†’ Generate unique ID
        â”‚   â””â”€â†’ snap-{timestamp}-{random}
        â”‚
        â”œâ”€â†’ Calculate points
        â”‚   â””â”€â†’ snapGameification.calculatePoints()
        â”‚
        â””â”€â†’ Structure SnapCard
              â”‚
              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ SnapCard                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ id: string               â”‚
  â”‚ imageUrl: string         â”‚ â—„â”€â”€â”€ Optimized URL
  â”‚ imageData: string        â”‚ â—„â”€â”€â”€ Original base64
  â”‚ caption: string          â”‚
  â”‚ tags: SnapTag[]          â”‚
  â”‚ pointsEarned: number     â”‚
  â”‚ author: {...}            â”‚
  â”‚ location: {...}          â”‚
  â”‚ createdAt: Date          â”‚
  â”‚ publishedTo: 'plate'     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ Store in workflow state
  useSnapWorkflow.setCardPreview(card)


Step 4: PUBLISH
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  User chooses: Plate OR Feed
        â”‚
        â”œâ”€â†’ PLATE PATH
        â”‚   â”‚
        â”‚   â–¼
        â”‚   snapPublishService.publishToPlate(card, userId)
        â”‚   â”‚
        â”‚   â–¼
        â”‚   PlateGateway.savePost({
        â”‚     content: card.caption,
        â”‚     image: card.imageUrl,
        â”‚     metadata: {...}
        â”‚   })
        â”‚   â”‚
        â”‚   â–¼ Result: { success, postId, error }
        â”‚
        â””â”€â†’ FEED PATH
            â”‚
            â–¼
            snapPublishService.publishToFeed(card, userId)
            â”‚
            â–¼
            supabase.from('feed_posts').insert({
              id, user_id, image_url,
              caption, tags, points_earned,
              location, created_at
            })
            â”‚
            â–¼ Result: { success, feedCardId, error }


COMMON FLOW
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Both paths merge
        â”‚
        â–¼
  If success:
    â€¢ Update user's points
    â€¢ Show success dialog
    â€¢ Store card ID for reference
    â€¢ Allow navigation to Plate or Feed
  
  If error:
    â€¢ Show error toast
    â€¢ Allow retry or cancel
    â€¢ Don't reset form state
```

---

## Service Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SERVICES LAYER                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

snapGameification.ts
â”œâ”€ TAG_POINT_VALUES: { cuisine: 10, dish: 10, ... }
â”œâ”€ calculatePoints(tags): number
â””â”€ createPointsNotification(points, tags): Notification

snapCardFormatter.ts
â”œâ”€ formatImageToCard(imageData, metadata, tags, caption, user): SnapCard
â”œâ”€ optimizeSnapImage(base64, width, height, quality): string
â””â”€ generateCardId(): string

snapPublishService.ts
â”œâ”€ publishToPlate(card, userId): Promise<{ success, postId, error }>
â”œâ”€ publishToFeed(card, userId): Promise<{ success, feedCardId, error }>
â””â”€ convertSnapCardToFeedCard(card): SnapFeedCard

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EXISTING SERVICES USED                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SavedItemsService
â””â”€ saveItem(itemId, itemType, metadata): Promise

PlateGateway
â”œâ”€ savePost(post): Promise
â”œâ”€ savePhoto(photo): Promise
â””â”€ saveBatch(items): Promise

FeedService
â”œâ”€ fetchFeed(userId, count): Promise<FeedCard[]>
â”œâ”€ fetchMasterbotCards(): Promise<MasterbotCard[]>
â””â”€ transformSnapCardToFeedCard(): FeedCard

ImageOptimizer
â”œâ”€ optimizeImageByType(url, type): string
â””â”€ getImageConfig(type): Config

AuthProvider
â”œâ”€ useAuth(): { user, loading, error }
â””â”€ signIn, signOut, signUp methods
```

---

## Step Component Interfaces

```typescript
// Step components share common props structure

interface ImageInputStepProps {
  onImageSelected: (metadata: ImageMetadata) => void;
  onCancel: () => void;
}

interface TaggingStepProps {
  imageUrl: string;
  onTagsSelected: (tags: SnapTag[]) => void;
  onBack: () => void;
  onCancel: () => void;
}

interface CardFormattingStepProps {
  card: SnapCard;
  onCaptionChanged: (caption: string) => void;
  onPublish: () => void;
  onBack: () => void;
  onCancel: () => void;
}

interface PublishStepProps {
  card: SnapCard;
  onPublish: (target: 'plate' | 'feed') => Promise<void>;
  onBack: () => void;
  onCancel: () => void;
}

interface SuccessDialogProps {
  card: SnapCard;
  pointsEarned: number;
  onViewInPlate: () => void;
  onShareToFeed: () => void;
}
```

---

## State Management with Hook

```typescript
interface UseSnapWorkflowReturn {
  // State
  imageSource: 'camera' | 'gallery' | null;
  imageMetadata: ImageMetadata | null;
  tags: SnapTag[];
  pointsEarned: number;
  cardPreview: SnapCard | null;
  publishTarget: 'plate' | 'feed' | null;
  currentStep: WorkflowStep;
  isLoading: boolean;
  
  // Actions
  setImageMetadata: (metadata: ImageMetadata) => void;
  setTags: (tags: SnapTag[]) => void;
  updateCardCaption: (caption: string) => void;
  setPublishTarget: (target: 'plate' | 'feed') => void;
  
  // Navigation
  nextStep: () => void;
  prevStep: () => void;
  reset: () => void;
  
  // Publishing
  publish: (userId: string, target: 'plate' | 'feed') => Promise<boolean>;
}
```

---

## Key Metrics & Analytics

Track these events for insights:

```
snap_flow_started
snap_image_source { camera | gallery }
snap_tags_selected { cuisine, dish, ambiance, custom }
snap_points_earned { value: 5-50 }
snap_card_formatted
snap_published_to { plate | feed }
snap_publish_success
snap_publish_error { error_type }
snap_flow_completed { duration: ms, points: num }
snap_flow_abandoned { step: which step }
```

---

## Error Scenarios & Handling

```
IMAGE INPUT
â”œâ”€ Camera permission denied
â”‚  â””â”€ Show permission request dialog
â”œâ”€ File too large (gallery)
â”‚  â””â”€ Show size limit error
â”œâ”€ Invalid file format
â”‚  â””â”€ Show format error
â””â”€ Geolocation unavailable
   â””â”€ Continue with null location

TAGGING
â””â”€ No tags selected
   â””â”€ Warn but allow continue

FORMATTING
â”œâ”€ Image optimization failed
â”‚  â””â”€ Use original image
â””â”€ Caption too long
   â””â”€ Enforce character limit

PUBLISHING
â”œâ”€ Network error
â”‚  â””â”€ Show retry button
â”œâ”€ Database error
â”‚  â””â”€ Show error + retry
â”œâ”€ Permission denied
â”‚  â””â”€ Redirect to login
â””â”€ Quota exceeded
   â””â”€ Show friendly message

GENERAL
â””â”€ Unknown error
   â””â”€ Log to Sentry + show generic message
```

---

## Performance Considerations

```
Image Processing
â”œâ”€ Run canvas operations in requestAnimationFrame
â”œâ”€ Debounce crop/rotate tool interactions
â”œâ”€ Compress to 600x600 max
â”œâ”€ Use WebP for better compression
â””â”€ Cache optimized images

Publishing
â”œâ”€ Show progress indicator for uploads
â”œâ”€ Batch multiple publishes if needed
â”œâ”€ Optimize image before upload
â””â”€ Retry failed uploads with exponential backoff

State Management
â”œâ”€ Only store necessary data in workflow state
â”œâ”€ Clear unused form data on step change
â”œâ”€ Memoize expensive calculations
â””â”€ Debounce form input handlers
```

---

